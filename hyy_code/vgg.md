VGGNet是由牛津大学VGG组提出的深度神经网络，它的主要工作是在AlexNet的基础上，通过更小的卷积核和更多的卷积层代替较大的卷积核，从而增加网络的深度。可以得到证明的是，多个堆积的小卷积核可以代替大卷积核，与此同时引入的更多非线性层可以保证学习更复杂的模式，而且参数数量可以得到控制。VGG神经网络的构造形式见表：

<img src="./hyy_code/pics/image-20220616130013987.png" alt="image-20220616130013987" style="zoom: 67%;" />

在本次项目中，考虑到数据是$28\times28$的灰度图片，我们使用了最常见的VGG16和VGG19网络（表中D、E结构），并在此基础上做了一些修改。由于VGG网络中有5个最大池化层，每经过一次池化层，输入的宽度和高度均会缩小到原来的一半，而$2^5>28$，所以我们去掉了第1、3和第5个最大池化层来保证该网络可以处理小尺寸的图片。

此外，草图图片的数据分布差异较大，不同类别的样本数据存在着比较大的差异，所以我们在每一个卷积层的输出后面增加了一层批标准化层，希望使数据分布在较小范围内，使训练过程更加稳定。
$$
\mu_{\Beta}\larr \frac{1}{m}\sum_{i=1}^{m}x_i \\
\sigma_{\Beta}^2 \larr \frac{1}{m}\sum_{i=1}^m(x_i-\mu_{\Beta})^2 \\
\hat{x_i} \larr \frac{x_i-\mu_{\Beta}}{\sqrt{\sigma_{\Beta}^2+\epsilon}}
$$
使用批标准化层的部分代码如下：

```PYTHON
def conv_layer(C_in, c_out, k, p):
    layer = tnn.Sequential(
        tnn.Conv2d(c_in, c_out, kernel_size=k, padding=p),
        tnn.BatchNorm2d(c_out),
        tnn.ReLU()
    )
    return layer
```







在本次实验中，我们使用PyTorch深度学习框架搭建了VGG16和VGG19网络，并进行了一些修改，增加了一些BN层，并且选择性的去掉了一些池化层。在搭建好网络类后，用`model = VGG19(n_classes=25)`即可创建模型。

为了保证实验的可重复性，参数需要固定而不是选择随机初始化。对于实验的设置方面，我们使用Adam作为优化器，mini batch的大小设置为64，初始学习率设置为0.001，并且使用ReduceLROnPlateau scheduler来动态调整学习率，即对平均loss进行监测，若若干次loss均保持较小差异，则降低学习率。

考虑到不同种类的数据分布比较均匀，不存在数据失衡的问题，我们采用准确率(Accuracy)来对模型进行评估。

我们分别对VGG16和VGG19两种不同深度的网络进行了实验，我们记录了10轮训练的模型在验证集上的准确率，实验结果如下：

![16and19](.\hyy_code\pics\16and19.png)

从图中可以看出，两个不同的网络在验证集上的分类准确率均先上升后下降最后稳定，而训练轮数等于4时，模型具有最好的性能，两个模型的最优性能差距很小。随着epoch的增大，模型显然出现了过拟合的现象。对比两个网络，VGG19具有更大的深度，出现过拟合后在验证集上的准确率也相对VGG16更低，即网络越复杂，越容易过拟合。

在实验过程中，由于只能保留两个池化层，我们也对保留不同池化层的不同模型均做了训练和测试，epoch=10时在验证集上的准确率均在82%左右，差异很小，故我们选择了去掉第1、3和第5个最大池化层的模型。

可以得出，VGG16可能在该草图分类问题上具有更优秀的性能。不同的网络在测试集上的结果如下表：

|          | VGG16   | VGG19       |
| -------- | ------- | ----------- |
| epoch=4  | 84.90 % | **85.06 %** |
| epoch=10 | 83.53 % | 83.13 %     |

表中可以看出，VGG网络在手绘草图数据集上训练后，模型的分类准确率最高为85.06 %。我们发现训练轮数更大的模型性能相对训练轮数较小的模型有着明显下降，而实验中的loss是一直下降的，这说明网络出现了过拟合。而VGG16和VGG19的最高准确率分别是84.90%和85.06%，差异不大，可以认为具有相同的性能，这也从侧面说明了使用VGG网络深度为16和19时基本处于最佳的表现水平，不必再对VGG13、VGG11进行更多的实验。

总的来说，对草图数据进行适配后的VGG16和VGG19模型在本次项目的草图分类任务中均有良好的表现，其中修改后的VGG19网络模型对草图的25类分类准确率有**85.06 %**的表现水平。此外，我们尝试将VGG网络的浅层特征下采样后与深层特征进行特征融合，希望将图片数据的位置结构信息和纹理信息综合考量，但实现过程中遇到的问题太多，由于时间原因未能得到较好结果。

